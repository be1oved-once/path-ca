<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin User Manager | PathCA</title>

<!-- Common layout & theme -->
<link rel="stylesheet" href="assets/css/common.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ===== Page Wrapper ===== */
.admin-page {
  max-width: 900px;
  margin: 80px auto 60px;
  padding: 0 14px;
  font-family: "Poppins", sans-serif;
}

/* ===== Heading ===== */
.admin-title {
  text-align: center;
  font-size: 18px;
  font-weight: 600;
  padding: 8px 14px;
  border-radius: 999px;
  background: linear-gradient(135deg,#6c63ff,#8b5cf6);
  color: #fff;
  width: fit-content;
  margin: auto auto 20px;
  box-shadow: 0 6px 18px rgba(99,102,241,0.35);
}

/* ===== User Card ===== */
.user-card {
  background: var(--card-bg,#ffffff);
  border-radius: 14px;
  padding: 10px 12px;
  margin-bottom: 10px;
  box-shadow: 0 4px 14px rgba(15,23,42,0.08);
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* text rows */
.user-row {
  font-size: 13px;
  display: flex;
  gap: 6px;
}

.user-label {
  font-weight: 600;
  color: #475569;
  min-width: 70px;
}

.user-value {
  color: #0f172a;
  word-break: break-all;
}

/* delete button */
.user-del-btn {
  margin-top: 6px;
  border: none;
  padding: 6px 10px;
  border-radius: 8px;
  background: #ef4444;
  color: white;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  width: fit-content;
}

.user-del-btn:hover {
  background: #dc2626;
}

/* ===== Status Text ===== */
.admin-status {
  text-align: center;
  font-size: 13px;
  color: #64748b;
  margin-top: 20px;
}

/* ===== Dark Mode ===== */
body.dark {
  --card-bg: #0f172a;
}

body.dark .user-label {
  color: #94a3b8;
}

body.dark .user-value {
  color: #e5e7eb;
}

body.dark .admin-status {
  color: #94a3b8;
}
</style>
</head>

<body>

<!-- Common Header -->

<main class="admin-page">

  <div class="admin-title">ADMIN USERS</div>

  <div id="userList" class="admin-status">Loading...</div>

</main>

<!-- Firebase Logic -->
<script type="module">
import { auth, db } from "./assets/js/firebase.js";

import {
  collection,
  getDocs,
  doc,
  deleteDoc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

import {
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const listDiv = document.getElementById("userList");

// ðŸ”’ Admin email
const ADMIN_EMAIL = "saurabhjoshionly@gmail.com";

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    listDiv.textContent = "Not logged in.";
    return;
  }

  if (user.email !== ADMIN_EMAIL) {
    listDiv.textContent = "Access denied. Admin only.";
    return;
  }

  loadUsers();
});

async function loadUsers() {
  listDiv.innerHTML = `<div class="admin-status">Loading users...</div>`;

  const snap = await getDocs(collection(db, "users"));

  if (snap.empty) {
    listDiv.innerHTML = `<div class="admin-status">No users found.</div>`;
    return;
  }

  listDiv.innerHTML = "";

  snap.forEach(userDoc => {
    const data = userDoc.data();
    const uid = userDoc.id;

    const div = document.createElement("div");
    div.className = "user-card";

    div.innerHTML = `
      <div class="user-row">
        <span class="user-label">UID:</span>
        <span class="user-value">${uid}</span>
      </div>
      <div class="user-row">
        <span class="user-label">Email:</span>
        <span class="user-value">${data.email || "â€”"}</span>
      </div>
      <div class="user-row">
        <span class="user-label">Username:</span>
        <span class="user-value">${data.username || "â€”"}</span>
      </div>
      <button class="user-del-btn" data-uid="${uid}">
        Delete Firestore Data
      </button>
    `;

    div.querySelector(".user-del-btn").onclick = async () => {
      if (!confirm("Delete this user's Firestore data?")) return;

      await deleteDoc(doc(db, "users", uid));
      await deleteDoc(doc(db, "publicLeaderboard", uid));

      alert("User Firestore data deleted");
      loadUsers();
    };

    listDiv.appendChild(div);
  });
}
</script>
<script src="assets/js/common-layout.js"></script>
<!-- Common theme logic -->
<script type="module" src="assets/js/common.js"></script>

</body>
</html>